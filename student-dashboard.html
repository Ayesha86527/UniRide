<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard - UniRide</title>
<link href="https://cdn.tailwindcss.com" rel="stylesheet">
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: #f0f4f8;
    }
    .header {
        background: #007BFF;
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .header h1 {
        font-size: 1.8rem;
        font-weight: 700;
    }
    .dashboard {
        padding: 20px;
    }
    .card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        transition: transform 0.2s ease;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .card h2 {
        color: #007BFF;
        margin-bottom: 10px;
    }
    .btn-primary {
        background: #007BFF;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .ride-item {
        background: white;
        border-radius: 12px;
        padding: 15px 20px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
</style>
</head>
<body>

<div class="header">
    <h1>Welcome, <span id="studentName">Student</span></h1>
    <button class="btn-primary" onclick="logout()">Logout</button>
</div>

<div class="dashboard">
    <div class="card">
        <h2>Search Available Rides</h2>
        <input type="text" id="searchFrom" placeholder="From" style="padding:10px; border-radius:10px; border:1px solid #ccc; margin-bottom:10px; width:100%;">
        <input type="text" id="searchTo" placeholder="To" style="padding:10px; border-radius:10px; border:1px solid #ccc; margin-bottom:10px; width:100%;">
        <button class="btn-primary" onclick="searchRides()">Search</button>
    </div>

    <div class="card">
        <h2>Available Rides</h2>
        <div id="availableRides">
            <p>No rides found. Use the search above!</p>
        </div>
    </div>

    <div class="card">
        <h2>My Booked Rides</h2>
        <div id="bookedRides">
            <p>No rides booked yet.</p>
        </div>
    </div>
</div>

<script>
    // Student info
    let studentName = prompt("Enter your name:") || "Student";
    document.getElementById('studentName').innerText = studentName;

    // Load rides posted by drivers
    let driverRides = JSON.parse(localStorage.getItem('driverRides') || '[]');
    let bookedRides = JSON.parse(localStorage.getItem('bookedRides') || '[]');
    let filteredRides = [];

    function updateBookedRides() {
        const bookedDiv = document.getElementById('bookedRides');
        if(bookedRides.length === 0){
            bookedDiv.innerHTML = "<p>No rides booked yet.</p>";
            return;
        }
        bookedDiv.innerHTML = bookedRides.map(r => `
            <div class="ride-item">
                <p>${r.from} → ${r.to} | ${new Date(r.time).toLocaleString()}</p>
            </div>
        `).join('');
    }

    function searchRides() {
        const from = document.getElementById('searchFrom').value.toLowerCase();
        const to = document.getElementById('searchTo').value.toLowerCase();

        filteredRides = driverRides.filter(r => 
            r.from.toLowerCase().includes(from) && r.to.toLowerCase().includes(to) && r.seats > 0
        );

        const availableDiv = document.getElementById('availableRides');
        if(filteredRides.length === 0) {
            availableDiv.innerHTML = "<p>No rides found for this route.</p>";
            return;
        }

        availableDiv.innerHTML = filteredRides.map((r, idx) => `
            <div class="ride-item">
                <p>${r.from} → ${r.to} | ${new Date(r.time).toLocaleString()} | Seats: ${r.seats}</p>
                <button class="btn-primary" onclick="bookRide(${idx})">Book</button>
            </div>
        `).join('');
    }

    function bookRide(index) {
        const ride = filteredRides[index];

        if(ride.seats <= 0){
            alert("No seats available!");
            return;
        }

        ride.seats--;
        bookedRides.push(ride);
        localStorage.setItem('driverRides', JSON.stringify(driverRides));
        localStorage.setItem('bookedRides', JSON.stringify(bookedRides));

        alert(`Ride booked from ${ride.from} → ${ride.to}`);
        searchRides();
        updateBookedRides();
    }

    function logout() {
        window.location.href = 'index.html';
    }

    // Initial render
    updateBookedRides();
</script>

</body>
</html>